<!DOCTYPE html>
<html>
	<head>
		<title>AMT | mainzed-Organigramm</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<script type="text/javascript" src="amt.js"></script>
		<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.20.0/vis.min.js"></script>
		<link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.20.0/vis.min.css" rel="stylesheet" type="text/css" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<style>
			* {
				margin: 0;
				padding: 0;
			}
			body {
				height: 100%;
				width: 100%;
				position: absolute;
				overflow: hidden;
				display: flex;
		    	min-height: 100vh;
		    	flex-direction: column;
			}
			#footer {
				height: 100px;
			}
			#graph {
				height: calc(100% - 100px);
			}
			.description {
				margin-left: 25px;
			}
			.modal {
				width: 60% !important;
				height: 80% !important;
			}
		</style>
		<script>
			var MAINZED = {};
			MAINZED.graph = {};
			MAINZED.edit = false;
			var update = function() {
				if (MAINZED.amt) {
					var updated = MAINZED.amt.getGraph(!MAINZED.edit,true);
					MAINZED.graph.edges.clear();
					MAINZED.graph.nodes.clear();
					for (var i in updated.nodes) {
						if (!MAINZED.edit) {
							updated.nodes[i].chosen = false;
						}
						if (updated.nodes[i].concept.includes("Person")) {
							updated.nodes[i].color = {background:'lightblue', border:'blue', highlight:{background:'white',border:'black'}};
							updated.nodes[i].shape = "box";
						}
						if (updated.nodes[i].concept.includes("Interest")) {
							updated.nodes[i].color = {background:'pink', border:'red', highlight:{background:'white',border:'black'}};
							updated.nodes[i].shape = "ellipse";
						}
					}
					for (var i in updated.edges) {
						updated.edges[i].chosen = false;
						if (updated.edges[i].width < 0.05) {
							updated.edges[i].hidden = !MAINZED.edit;
						}
						if (updated.edges[i].role.includes("connectedWith")) {
							updated.edges[i].color = {color:"blue", highlight:"black"};
							updated.edges[i].dashes = true;
							if (updated.edges[i].from.localeCompare(updated.edges[i].to) >= 0) {
								updated.edges[i].hidden = !MAINZED.edit;
							}
						}
						if (updated.edges[i].role.includes("interestedIn")) {
							updated.edges[i].color = {color:"green", highlight:"black"};
							updated.edges[i].arrows = "to";
						}
						if (updated.edges[i].role.includes("narrowerThan")) {
							updated.edges[i].color = {color:"red", highlight:"black"};
							updated.edges[i].arrows = "from";
							updated.edges[i].hidden = !MAINZED.edit;
						}
						if (updated.edges[i].role.includes("matchWith")) {
							updated.edges[i].color = {color:"red", highlight:"black"};
							updated.edges[i].dashes = true;
						}
						if (updated.edges[i].role.includes("broaderThan")) {
							updated.edges[i].color = {color:"red", highlight:"black"};
							updated.edges[i].arrows = "to";
						}
					}
					MAINZED.graph.nodes.update(updated.nodes);
					MAINZED.graph.edges.update(updated.edges);
				}
			};
			var edit = function(on) {
				MAINZED.edit = on;
				$(".edit").toggle();
				$(".normal").toggle();
				update();
			}
			$(function() {
				MAINZED.amt = new AMT();
				MAINZED.amt.load(function() {
					var graph = MAINZED.amt.getGraph(true);
					MAINZED.graph.nodes = new vis.DataSet(graph.nodes);
					MAINZED.graph.edges = new vis.DataSet(graph.edges);
					update();
					new vis.Network(document.getElementById("graph"),{nodes: MAINZED.graph.nodes, edges: MAINZED.graph.edges},{});
				});
				$(".edit").hide();
			});
		</script>
	</head>

	<body>
		<div id="graph" class="col s12"></div>
		<div id="footer" class="page-footer grey col s12">
			<div class="container">
				<div class="row">
					<div class="col s6 left-align">
						<b class="description">AMT. Academic Meta Tool.</b>
					</div>
					<div class="col s3 right-align">
						<a class="btn-floating btn-large edit green" onclick="add()" title="Add individual"><i class="material-icons">add</i></a>
						<a class="btn-floating btn-large edit red" onclick="edit(false)" title="Close edit mode"><i class="material-icons">edit</i></a>
						<a class="btn-floating btn-large normal green" onclick="edit(true)" title="Open edit mode"><i class="material-icons">edit</i></a>
					</div>
					<div class="save col s3 right-align">
						<a class="btn-floating btn-large edit red" onclick="cancel()" title="Cancel changes"><i class="material-icons">cancel</i></a>
						<!--<a class="btn-floating btn-large normal black" onclick="save()" title="Save changes"><i class="material-icons">save</i></a>-->
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
